add_subdirectory(protos)

project(distributed-runtime VERSION 0.1 LANGUAGES CXX)

#-----------------------------------------------------------------------
# Proteus: Distributed Runtime
#-----------------------------------------------------------------------

set(_PROTOBUF_LIBPROTOBUF libprotobuf)
set(_REFLECTION grpc++_reflection)
set(_PROTOBUF_PROTOC $<TARGET_FILE:protoc>)
set(_GRPC_GRPCPP grpc++)

add_library(${PROJECT_NAME} SHARED
  lib/cluster-manager.cpp
  lib/cluster-control.cpp
  )

# FIXME: error generated by grpc headers.
#        We should either way include them as system headers
target_compile_options(${PROJECT_NAME} BEFORE PRIVATE
  -Wno-error=undef
  -Wno-error=documentation
  -Wno-error=documentation-unknown-command
  -Wno-error=missing-noreturn
  -Wno-error=unused-template
  )

# Additional (to the proteus-lib default includes) include directories
target_include_directories(${PROJECT_NAME}
  SYSTEM PRIVATE
  ${CMAKE_CURRENT_BINARY_DIR}
  )

target_link_libraries(${PROJECT_NAME}
  PUBLIC
  proteus::olap
  PRIVATE
  ${_REFLECTION}
  ${_GRPC_GRPCPP}
  proteus::command_provider
  proteus::protos
  )

include(proteus-lib)
add_library(proteus::runtime ALIAS ${PROJECT_NAME})
